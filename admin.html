<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œìŠ¤í…œ ê´€ë¦¬ì</title>
    <script src="auth.js"></script>
    <style>
        body { background: #050a14; color: #eee; font-family: sans-serif; display:none; padding: 20px; }
        body.secure-visible { display: block; }
        .panel { max-width: 600px; margin: auto; background: #111; padding: 25px; border-radius: 20px; border: 1px solid #D4AF37; }
        h2 { color: #D4AF37; border-left: 4px solid #D4AF37; padding-left: 10px; margin-top: 0; }
        h3 { font-size: 1.1rem; border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 30px; }
        
        /* ê³µì§€ì‚¬í•­ ëª©ë¡ ìŠ¤íƒ€ì¼ */
        .notice-item { background: #222; border: 1px solid #444; padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; }
        .notice-text { font-size: 0.9rem; line-height: 1.4; color: #ddd; flex-grow: 1; }
        .notice-date { font-size: 0.75rem; color: #D4AF37; margin-bottom: 5px; }
        
        /* ë²„íŠ¼ ë° ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
        textarea { width: 100%; padding: 15px; margin: 10px 0; background: #1a1a1a; border: 1px solid #555; color: white; border-radius: 8px; resize: vertical; box-sizing: border-box; }
        input { width: 100%; padding: 15px; margin: 10px 0; background: #1a1a1a; border: 1px solid #555; color: white; border-radius: 8px; box-sizing: border-box; }
        
        .btn-add { background: #D4AF37; color: #000; border: none; padding: 12px; font-weight: bold; border-radius: 8px; width: 100%; cursor: pointer; }
        .btn-del { background: transparent; border: 1px solid #d9534f; color: #d9534f; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; white-space: nowrap; }
        
        .back-btn { display: block; text-align: center; margin-top: 30px; color: #666; text-decoration: underline; }
    </style>
</head>
<body>
    <div class="panel">
        <h2>ğŸ› ï¸ í´ë¼ìš°ë“œ í†µí•© ê´€ë¦¬</h2>
        
        <h3>ğŸ“¢ ë©”ì¸ í™”ë©´ ê³µì§€ì‚¬í•­ ê´€ë¦¬</h3>
        <div id="mainAdminList"></div>
        <textarea id="mIn" rows="3" placeholder="ìƒˆ ë©”ì¸ ê³µì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        <button class="btn-add" onclick="addNotice('main')">+ ë©”ì¸ ê³µì§€ ì¶”ê°€í•˜ê¸°</button>

        <h3>ğŸš© íŒ€ë³„ ì„œë¸Œ ê³µì§€(ì§€ì¹¨) ê´€ë¦¬</h3>
        <div id="subAdminList"></div>
        <textarea id="sIn" rows="3" placeholder="ìƒˆ ì„œë¸Œ ê³µì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        <button class="btn-add" onclick="addNotice('sub')">+ ì„œë¸Œ ê³µì§€ ì¶”ê°€í•˜ê¸°</button>

        <h3>ğŸ” ì‹œìŠ¤í…œ ì•”í˜¸ ë³€ê²½</h3>
        <input type="password" id="pIn" placeholder="ìƒˆ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ê³  ì•„ë˜ ê°±ì‹  ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”">
        <button class="btn-add" style="background:#555; color:white;" onclick="changePassword()">ì•”í˜¸ë§Œ ê°±ì‹ í•˜ê¸°</button>

        <a href="index.html" class="back-btn">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <script>
        // ê´€ë¦¬ì í™”ë©´ì´ ì¼œì§€ë©´ ê³µì§€ ë¦¬ìŠ¤íŠ¸ë¥¼ ê·¸ë ¤ì¤Œ
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                renderAdminList('mainAdminList', cloudData.notices_main, 'main');
                renderAdminList('subAdminList', cloudData.notices_sub, 'sub');
            }, 500); // í´ë¼ìš°ë“œ ë°ì´í„° ë¡œë“œ ëŒ€ê¸°
        });

        // í˜„ì¬ ë‚ ì§œ í¬ë§·íŒ… í•¨ìˆ˜ (ì˜ˆ: "2026. 2. 19. 19:30")
        function getNowDate() {
            const now = new Date();
            return `${now.getFullYear()}. ${now.getMonth()+1}. ${now.getDate()}. ${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
        }

        // ê³µì§€ ì¶”ê°€ í•¨ìˆ˜
        async function addNotice(type) {
            const inputId = type === 'main' ? 'mIn' : 'sIn';
            const text = document.getElementById(inputId).value.trim();
            if (!text) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");

            const newNotice = {
                id: Date.now(), // ê³ ìœ  ID ë¶€ì—¬
                text: text,
                date: getNowDate()
            };

            if (type === 'main') cloudData.notices_main.push(newNotice);
            else cloudData.notices_sub.push(newNotice);

            await syncCloud();
            document.getElementById(inputId).value = ""; // ì…ë ¥ì°½ ë¹„ìš°ê¸°
        }

        // ê³µì§€ ì‚­ì œ í•¨ìˆ˜
        async function deleteNotice(type, id) {
            if (!confirm("ì´ ê³µì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            if (type === 'main') {
                cloudData.notices_main = cloudData.notices_main.filter(n => n.id !== id);
            } else {
                cloudData.notices_sub = cloudData.notices_sub.filter(n => n.id !== id);
            }
            await syncCloud();
        }

        // ì•”í˜¸ ë³€ê²½ í•¨ìˆ˜
        async function changePassword() {
            const pw = document.getElementById('pIn').value;
            if(!pw) return alert("ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            cloudData.sys_password = pw;
            await syncCloud();
            document.getElementById('pIn').value = "";
        }

        // í´ë¼ìš°ë“œì— ìµœì¢… ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        async function syncCloud() {
            try {
                // cloudData ê°ì²´ë¥¼ í†µì§¸ë¡œ íŒŒì´ì–´ë² ì´ìŠ¤ì— ë®ì–´ì”€
                await fetch(DB_URL, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cloudData)
                });
                alert("âœ… ì„±ê³µì ìœ¼ë¡œ ì„œë²„ì— ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
                
                // í™”ë©´ ë¦¬ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
                renderAdminList('mainAdminList', cloudData.notices_main, 'main');
                renderAdminList('subAdminList', cloudData.notices_sub, 'sub');
            } catch (error) {
                alert("í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        }

        // ê´€ë¦¬ììš© ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ í•¨ìˆ˜
        function renderAdminList(elementId, array, type) {
            const el = document.getElementById(elementId);
            if (!array || array.length === 0) {
                el.innerHTML = "<p style='color:#777; font-size:0.9rem;'>ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
                return;
            }
            
            let html = "";
            const sorted = [...array].reverse(); // ìµœì‹ ê¸€ ìƒë‹¨ ë…¸ì¶œ
            
            sorted.forEach(n => {
                html += `
                <div class="notice-item">
                    <div>
                        <div class="notice-date">${n.date}</div>
                        <div class="notice-text">${n.text.replace(/\n/g, '<br>')}</div>
                    </div>
                    <button class="btn-del" onclick="deleteNotice('${type}', ${n.id})">ì‚­ì œ</button>
                </div>`;
            });
            el.innerHTML = html;
        }
    </script>
</body>
</html>
