<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì„œìš¸ì•„íŠ¸ì„¼í„° ì‹œìŠ¤í…œ ê´€ë¦¬</title>
    <script src="auth.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { background: #050a14; color: #eee; font-family: sans-serif; display:none; padding: 5vw; min-height: 100vh;}
        body.secure-visible { display: block; }
        .panel { max-width: 600px; margin: auto; background: #111; padding: 6vw; border-radius: 20px; border: 1px solid #D4AF37; }
        h2 { color: #D4AF37; border-left: 4px solid #D4AF37; padding-left: 10px; margin-top: 0; font-size: clamp(1.3rem, 5vw, 1.6rem); }
        h3 { font-size: clamp(1rem, 4vw, 1.2rem); border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 30px; }
        .notice-item { background: #222; border: 1px solid #444; padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; }
        .notice-text { font-size: 0.9rem; line-height: 1.4; color: #ddd; flex-grow: 1; }
        .notice-date { font-size: 0.75rem; color: #D4AF37; margin-bottom: 5px; }
        textarea, input { width: 100%; padding: 15px; margin: 10px 0; background: #1a1a1a; border: 1px solid #555; color: white; border-radius: 8px; resize: vertical; }
        .btn-add { background: #D4AF37; color: #000; border: none; padding: 15px; font-weight: bold; border-radius: 8px; width: 100%; cursor: pointer; font-size: 1rem; }
        .btn-del { background: transparent; border: 1px solid #d9534f; color: #d9534f; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; white-space: nowrap; }
        .back-btn { display: block; text-align: center; margin-top: 30px; color: #666; text-decoration: underline; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="panel">
        <h2>ğŸ› ï¸ ì„œìš¸ì•„íŠ¸ì„¼í„° í†µí•© ê´€ë¦¬</h2>

        <h3>ğŸ“¢ ë©”ì¸ í™”ë©´ ê³µì§€ì‚¬í•­ ê´€ë¦¬</h3>
        <div id="mainAdminList"></div>
        <textarea id="mIn" rows="3" placeholder="ìƒˆ ë©”ì¸ ê³µì§€ë¥¼ ì—¬ëŸ¬ ì¤„ë¡œ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        <button class="btn-add" onclick="addNotice('main')">+ ë©”ì¸ ê³µì§€ ì¶”ê°€í•˜ê¸°</button>

        <h3>ğŸš© íŒ€ë³„ ì„œë¸Œ ê³µì§€(ì§€ì¹¨) ê´€ë¦¬</h3>
        <div id="subAdminList"></div>
        <textarea id="sIn" rows="3" placeholder="ìƒˆ ì„œë¸Œ ê³µì§€ë¥¼ ì—¬ëŸ¬ ì¤„ë¡œ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        <button class="btn-add" onclick="addNotice('sub')">+ ì„œë¸Œ ê³µì§€ ì¶”ê°€í•˜ê¸°</button>

        <h3>ğŸ” ì‹œìŠ¤í…œ ì•”í˜¸ ë³€ê²½</h3>
        <input type="password" id="pIn" placeholder="ìƒˆ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        <button class="btn-add" style="background:#555; color:white;" onclick="changePassword()">ì•”í˜¸ ê°±ì‹ í•˜ê¸°</button>

        <a href="index.html" class="back-btn">ë©”ì¸ ë¡œë¹„ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                renderAdminList('mainAdminList', cloudData.notices_main, 'main');
                renderAdminList('subAdminList', cloudData.notices_sub, 'sub');
            }, 500);
        });

        function getNowDate() {
            const now = new Date();
            return `${now.getFullYear()}. ${now.getMonth()+1}. ${now.getDate()}. ${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
        }

        async function addNotice(type) {
            const inputId = type === 'main' ? 'mIn' : 'sIn';
            const text = document.getElementById(inputId).value.trim();
            if (!text) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
            const newNotice = { id: Date.now(), text: text, date: getNowDate() };
            if (type === 'main') cloudData.notices_main.push(newNotice);
            else cloudData.notices_sub.push(newNotice);
            await syncCloud();
            document.getElementById(inputId).value = "";
        }

        async function deleteNotice(type, id) {
            if (!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            if (type === 'main') cloudData.notices_main = cloudData.notices_main.filter(n => n.id !== id);
            else cloudData.notices_sub = cloudData.notices_sub.filter(n => n.id !== id);
            await syncCloud();
        }

        async function changePassword() {
            const pw = document.getElementById('pIn').value;
            if(!pw) return alert("ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            cloudData.sys_password = pw;
            await syncCloud();
            document.getElementById('pIn').value = "";
        }

        async function syncCloud() {
            try {
                await fetch(DB_URL, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cloudData)
                });
                alert("âœ… ì„œìš¸ì•„íŠ¸ì„¼í„° ì„œë²„ì— ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
                renderAdminList('mainAdminList', cloudData.notices_main, 'main');
                renderAdminList('subAdminList', cloudData.notices_sub, 'sub');
            } catch (error) { alert("í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); }
        }

        function renderAdminList(elementId, array, type) {
            const el = document.getElementById(elementId);
            if (!array || array.length === 0) {
                el.innerHTML = "<p style='color:#777; font-size:0.9rem;'>ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
                return;
            }
            let html = "";
            const sorted = [...array].reverse();
            sorted.forEach(n => {
                html += `
                <div class="notice-item">
                    <div>
                        <div class="notice-date">${n.date}</div>
                        <div class="notice-text">${n.text.replace(/\n/g, '<br>')}</div>
                    </div>
                    <button class="btn-del" onclick="deleteNotice('${type}', ${n.id})">ì‚­ì œ</button>
                </div>`;
            });
            el.innerHTML = html;
        }
    </script>
</body>
</html>